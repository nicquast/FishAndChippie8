//
// Created by nic on 15/11/25.
//

#include "memory.h"

#include <stdio.h>
#include <stdlib.h>


#define FONT_SIZE 80
const byte_t font[FONT_SIZE] = {
    0xF0, 0x90, 0x90, 0x90, 0xF0, // 0
    0x20, 0x60, 0x20, 0x20, 0x70, // 1
    0xF0, 0x10, 0xF0, 0x80, 0xF0, // 2
    0xF0, 0x10, 0xF0, 0x10, 0xF0, // 3
    0x90, 0x90, 0xF0, 0x10, 0x10, // 4
    0xF0, 0x80, 0xF0, 0x10, 0xF0, // 5
    0xF0, 0x80, 0xF0, 0x90, 0xF0, // 6
    0xF0, 0x10, 0x20, 0x40, 0x40, // 7
    0xF0, 0x90, 0xF0, 0x90, 0xF0, // 8
    0xF0, 0x90, 0xF0, 0x10, 0xF0, // 9
    0xF0, 0x90, 0xF0, 0x90, 0x90, // A
    0xE0, 0x90, 0xE0, 0x90, 0xE0, // B
    0xF0, 0x80, 0x80, 0x80, 0xF0, // C
    0xE0, 0x90, 0x90, 0x90, 0xE0, // D
    0xF0, 0x80, 0xF0, 0x80, 0xF0, // E
    0xF0, 0x80, 0xF0, 0x80, 0x80  // F
};

byte_t* initMemory() {
    byte_t* memory = malloc (sizeof(byte_t) * 4096);
    for (int i = 0; i < FONT_SIZE; i++)
        memory[i] = font[i];
    return memory;
}

// Note: This is technically unsafe since we could be out of bounds on the byte array if for some reason it's too small
// I should enforce memory length more strictly at some point...
void loadRom(FILE* rom_fp, byte_t* memory) {
    for (int i = ROM_START_ADDRESS; i <= MEMORY_LENGTH; i++) {
        int byte = fgetc(rom_fp);
        if (byte == EOF) return;
        memory[i] = (byte_t) byte;
    }
}